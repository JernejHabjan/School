<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WebGL</title>

    <script id="shader-vert" type="vertex-shader">
   		uniform mat4 projectionMatrix;
   		uniform mat4 viewMatrix;
   		uniform mat4 modelMatrix;

    	attribute vec3 vertex;
    	attribute vec3 color;
    	attribute vec3 normal;
    	attribute vec2 uv;
    	
    	varying vec3 outColor;
    	varying vec3 outNormal;
    	varying vec2 outUV;
    	varying vec3 outVertex;

    	void main(){
    		vec4 pos = modelMatrix * vec4(vertex, 1.0);
    		gl_Position = projectionMatrix * viewMatrix * pos;
    		outVertex = vec3(pos);
    		outColor = color;
    		outNormal = vec3(modelMatrix * vec4(normal, 0.0));
    		outUV = uv;
    	}

    </script>

    <script id="shader-frag" type="fragment-shader">
    	precision mediump float;
    	uniform vec3 lightPosition;
    	uniform sampler2D texture;

    	varying vec3 outVertex;
    	varying vec3 outColor;
    	varying vec3 outNormal;
    	varying vec2 outUV;

    	const vec3 ambientColor = vec3(0.2);
    	const vec3 diffuseColor = vec3(0.8);
    	const vec3 specularColor = vec3(1.0);
    	const float qAtt = 5.0;
    	const float lAtt = 1.0;
    	const float shine = 20.0;

    	void main(){
    		float d = length(lightPosition - outVertex);
    		float r =  1.0 / 1.0 + lAtt * d ;

    		

    		vec4 textureColor = texture2D(texture, outUV);
    		vec3 normalizedNormal = normalize(outNormal);
    		vec4 ambient = textureColor * vec4(ambientColor, 1.0);

    		vec3 surfaceToLight = normalize(lightPosition - outVertex);
    		float dContribution = max(0.1, dot(normalizedNormal, surfaceToLight));
    		vec4 diffuse = textureColor * vec4(diffuseColor, 1.0) * dContribution;

    		vec3 surfaceToView = normalize(lightPosition - outVertex);
    		float sContribution = pow(max(0.0, dot(surfaceToView,reflect(-surfaceToLight, normalizedNormal))), shine);
    		vec4 specular = textureColor * vec4(specularColor, 1.0) * sContribution;

    		gl_FragColor = vec4(vec3(ambient + (diffuse * vec4(outColor, 1.0)* r + specular) ), 1.0);
    	}

    </script>

    <script src="Vector3.js"></script>
    <script src="Matrix4x4.js"></script>
	<script src="Matrix.js"></script>
	<script src="Shader.js"></script>
	<script src="Cube.js"> </script>
    <script src="WebGL.js"></script>

</head>
<body onload="initWebGL()" style="background-color: #ffffff">
    <canvas style="background:#ffffff"; id="context" width="900" height="600"> test </canvas>
    <p id="time"> 0.0 </p>

    <b><h2> MODEL MATRIX </h2></b> <hr>
    <b><h2 style="font-size:40px" id="matrix"> MATRIX </h2></b> <br><br> 
</body>
</html>
