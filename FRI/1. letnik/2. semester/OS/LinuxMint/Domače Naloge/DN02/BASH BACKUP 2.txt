#!/bin/bash

readFile(){ #v seznam prebere besede
	i=0
	stBesed=0
	datoteka=$1
	while read line; do
		for word in $line; do
			
			temp=""
			for((j=0; j< ${#word}; j++)); do #crko za crko


				#fixi za ord
					
				#LAH TRIM ZA \n pa pika...

				#if [[ $((printf '%d\n' "'${temp:j:1}")) -lt 65 ]]; then #če ma čudn znak
				#  echo lol
				
				#else #nima nc not
				temp+=${word:j:1}
				#fi	
			  done
			
			seznam[i]=$temp
			(( stBesed++ ))
			
			(( i++ ))
		done
	done < "$datoteka"

	
	#_______________________
	#je narjen array

	sorted=($(printf '%s\n' "${seznam[@]}"|sort|uniq)) #dunno but works
	

	k=0
	for word in ${sorted[*]}; do #prešteje št ponovitev
		count=0
		for word1 in ${seznam[*]}; do
		    if [[ $word == $word1 ]]; then
			(( count++ ))
		    fi
		done 
		sezPonovitev[k]=$count" "$word # v sez ponovitev da št ponovitev in besedo
		(( k++ ))

	done


	#sezPonovitev=($(printf '%s\n' "${sezPonovitev[@]}"|sort)) #ga sortamo po cifrah
	#SORTNE DELA PROV
	
	LC_NUMERIC=C LC_COLLATE=C #da mi dela s piko
	for((i=0; i<${#sezPonovitev[@]}; i++)); do
		Ponovitev=$(echo "${sezPonovitev[i]%% *}")
		ponovitevProcent=$(echo "$Ponovitev * 100/$stBesed" | bc -l) #devetko nadomestiš z št ponovitev
		printf "${sezPonovitev[i]} %.2f%%\n" $ponovitevProcent ##ROUNDA ->WRONG

		
							
	 done
}

noFlagsRead(){
  for((i=0; i<${#seznam[@]}; i++)); do
	echo ${seznam[i]}
  done

}


flag(){
  case "$1" in 
	-l)
            echo "Mora biti: "$2"-znakov."
	    readFile $3
        ;;
        -n) 
	     echo "Mora biti: "$2"-ponovitev."
	     readFile $3
        ;;
        *)
	    echo "Napaka: neznano stikalo $1.">&2; exit 1; #se menja $2 in &2
        ;;
  esac 
}

checkRead(){
   if ! [ -r "$1" ]; then
	echo "Napaka: datoteka $1 ne obstaja.">&2; exit 1 #DELA
   fi
}


stArg=$#
case "$stArg" in
	0) echo "Kot argument skripti $(basename $0) morate podati ime vaše skripte."; exit 1;;
	1)checkRead $1; readFile $1;;
	3)checkRead $3; flag $1 $2 $3;;
	5)checkRead $5; flag $1 $2 $5; flag $3 $4 $5;;
	*)echo "Too many args.";;
esac
